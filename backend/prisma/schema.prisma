generator client { 
  provider = "prisma-client-js" 
  }
datasource db { 
  provider = "postgresql"
  url = env("DATABASE_URL") 
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  displayName  String?
  astroEnabled Boolean  @default(false)
  birthDate    DateTime?
  birthTime    String?
  birthPlace   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  checkins       CheckIn[]
  journals       Journal[]
  conversations  Conversation[]
}

model CheckIn {
  id         String   @id @default(uuid())
  userId     String
  date       DateTime
  mood       Int
  note       String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  deletedAt  DateTime?

  user User @relation(fields: [userId], references: [id])
}

model Journal {
  id         String   @id @default(uuid())
  userId     String
  text       String
  aiSummary  String?
  tags       Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  deletedAt  DateTime?

  user User @relation(fields: [userId], references: [id])
}

model Conversation {
  id         String   @id @default(uuid())
  userId     String
  mode       String   // 'coach' | 'astroCoach'
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  deletedAt  DateTime?

  user     User      @relation(fields: [userId], references: [id])
  messages Message[]
}

model Message {
  id              String   @id @default(uuid())
  conversationId  String
  role            String   // 'user' | 'assistant'
  content         String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?

  conversation Conversation @relation(fields: [conversationId], references: [id])
}

